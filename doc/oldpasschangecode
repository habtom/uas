<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="keywords" content="Jimma University Email System, Jimma University Web mail, Jimma University Webmail, Jimma University mail, email system, Jimma, Jimma University"  />
<meta name="description" content="Jimma University email system, Jimma University web mail" />
<script language="javascript" src="PasswordStrengthMeter/jquery.js"></script>
<script language="javascript" src="PasswordStrengthMeter/passwordStrengthMeter.js"></script>
<script language="javascript">
	jQuery(document).ready(function() {
		$('#emailid').keyup(function(){$('#result').html(passwordStrength($('#newpassword').val(),$('#emailid').val()))})
		$('#newpassword').keyup(function(){$('#result').html(passwordStrength($('#newpassword').val(),$('#emailid').val()))})
	})
	function showMore()
	{
		$('#more').slideDown()
	}
</script>
<title>Jimma University Email System</title>
<style type="text/css">
<!--
/* Global Styles */

body {
	margin:0px;
	}
	
td {
	font:12px arial;
	color:#000066;
	}
	
hr {
	height:1px; 
	color: #cccccc;
	border: none;
	}
	
a {
	color: #CC3300;
	text-decoration:underline;
	}
	
a:hover {
	color: #FF3300;
	text-decoration:none;
	}
/* ID Styles */
#toptable{
margin-top:0px;
}

#banner {
	font:18px georgia;
	color: #FFFFFF;
	line-height:24px;
	letter-spacing:.4em;
	}

#banner-message {
	font:13px georgia;
	color: #FFFFFF;
	line-height:24px;
	letter-spacing:.4em;
	}


#menu a{
	font-family:Arial, Helvetica, sans-serif;
	color:#333333;
	font-weight:bold;
	text-decoration: none;
	letter-spacing:.1em;
	line-height:16px;
}

#menu a:hover {
	color:#95ADC8;
}

#detail{
padding:10px 10px 15px 10px;
border-bottom:#CCCCCC 1px solid;
}

#news{
padding:10px 10px 10px 10px;
}


#events{
padding:10px 10px 10px 15px;
border-left:#CCCCCC 1px solid;
}

#bottom td{
font:Arial, Helvetica, sans-serif;
font-size:12px;
color:#999999;
}

#bottom a {
color:#CCCCCC;
}

#bottom a:hover {
color:#999999;
}
a {
margin-bottom:5px;
color:#FF0000;
font-family:Arial, Helvetica, sans-serif;
text-decoration:none;}

#leftLinkHeader{
/* background:#111737;*/
font-weight:bold;
font-size:14px;
color:#CCCCCC;
padding-bottom:5px;
padding-top:5px;
margin-left:5px;
margin-right:5px;
background:#F7F7F7;
}


.leftLinkDetail{
	font-family:Arial, Helvetica, sans-serif;
	color:#000000;
	text-decoration: none;
	letter-spacing:.1em;
	line-height:16px;
	margin-left:5px;
	margin-right:5px;
	margin-bottom:10px;
	background:#FFFFFF;
}

.leftlink{

}

.leftlink a {
color:#000000;
line-height:2em;
text-decoration:none;
}

.leftlink a:hover {
color:#999999;
text-decoration:none;
}

.font-style{
font-size:12px;
font-family:Arial, Helvetica, sans-serif;
}

.subHeader {
	font:16px georgia;
	color: #CC3300;
	font-weight:bold;
	letter-spacing:.1em;
	line-height:16px;
	}	

.bodyText{
	line-height:20px;
	letter-spacing:.1em;
}

.bodyText a{
color:#006666;
text-decoration:underline;
}

.bodyText a:hover{
color:#009966;
text-decoration:none;
}

.bodyText img{
float:left;
}
div.A-ZOptions {margin:10px;
}
.style1 {color:#660000;}

.topborder{
border-top:#000000 solid 1px;
border-left:#000000 solid 1px;}
-->
</style>
</head>

<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td width="7%" rowspan="3" bgcolor="#F7F7F7"><a href="http://www.ju.edu.et" class="style1"><img src="images/logoju3.gif" alt="Jimma University" width="65" height="65" border="0" longdesc="http://www.ju.edu.et" /></a></td>
    <td rowspan="3" bgcolor="#F7F7F7" id="banner"><span class="style1">JIMMA <br />
    UNIVERSITY</span></td>
    <td width="54%" bgcolor="#F7F7F7"><span class="style1"></span></td>
  </tr>
  <tr>
    <td height="32" bgcolor="#F7F7F7" id="banner-message"><span class="style1">THE FIRST HIGHER INSTITUTION OF <br />
    COMMUNITY BASED EDUCATION  IN ETHIOPIA </span></td>
  </tr>
  <tr>
    <td height="19" bgcolor="#F7F7F7"><span class="style1"></span></td>
  </tr>
</table>
<table width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="20%" valign="top" bgcolor="#F7F7F7" class="leftlink">
	<table width="108%" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td colspan="2" bgcolor="#F7F7F7">&nbsp;</td>
        </tr>
        <tr>
          <td width="94%" valign="top" bgcolor="#F7F7F7">
		  	<div align="center" id="leftLinkHeader">JU Mail Links  </div>
            <div class="leftLinkDetail"> <a href="http://mail.ju.edu.et">Go to JU Mail System </a><br />
                  <a href="http://mail.ju.edu.et/email-changepass/index.php">Change Email Password </a><br />
             <br />
            </div>
		  	<div align="center" id="leftLinkHeader">Get JU Mail Account  </div>
            <div class="leftLinkDetail"> 
			<a href="future/future.php">
				Register and Get Email Account			 </a>
			 <br />
            </div>
		  	<div align="center" id="leftLinkHeader">Email Activity Graphs </div>
            <div class="leftLinkDetail"> <a href="http://mail.ju.edu.et/cgi-bin/mailgraph.cgi">Sent and received messages </a><br />
                  <a href="http://mail.ju.edu.et/cgi-bin/queuegraph.cgi">Emails in the queue to be delivered </a><br />
                  <a href="http://mail.ju.edu.et/cgi-bin/couriergraph.cgi">IMAP connections </a><br />
            </div>		  </td>
        </tr>
    </table></td>
    <td align="right" valign="top" style="background-repeat:repeat-x;">
	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="topborder">
      <tr>
        <td width="243">&nbsp;</td>
        <td width="243">&nbsp;</td>
        <td colspan="2">&nbsp;</td>
        <td width="243">&nbsp;</td>
        <td width="243">&nbsp;</td>
      </tr>
      
      
      <tr>
        <td colspan="6" align="left">
		</td>
        </tr>
      <tr>
        <td colspan="6" align="left">&nbsp;</td>
      </tr>
      
      <tr>
        <td colspan="6">
          
<?php
include 'library/config.php';
include 'library/opendb.php';
require_once 'library/CHAP.php';

if(isset($_POST['submit']))
{
        //collect data from the form
        $emailid        = $_POST['emailid'];
        $oldpassword    = $_POST['oldpassword'];
        $newpassword    = $_POST['newpassword'];
        $confirmnewpass = $_POST['confirmnewpassword'];

        //check input fields
        if($emailid == '')
        {
                $errmsgemailid =  "please enter Email id";
        }
        else if($oldpassword == '')
        {
                $errmsgoldpassword =  "Please Enter old password password";
        }
        else if($newpassword == '')
        {
                $errmsgnewpassword =  "Please Enter new password password";
        }
        else if($confirmnewpass == '')
        {
                $errmsgconfirmnewpass =  "Please Enter password to confirm";
        }
        else if($newpassword !== $confirmnewpass)
        {
                $errmsgconfirmnewpass =  "Your new passwords do not much";
        }
        else
        {
                //select match from the database
                $query = "SELECT local_part, crypt_password ".
                                 "FROM users ".
                                 "WHERE local_part = '$emailid'";
                $result = mysql_query($query) or die('Error : ' . mysql_error());

                if(mysql_num_rows($result) == 1)
                {
 						$user_row = mysql_fetch_array($result);
                        $crypt_oldpassword = $user_row['crypt_password'];
                        // Check old password
                        if(crypt($oldpassword, $crypt_oldpassword) == $crypt_oldpassword)
                        {
                                $crypt_newpassword = crypt($newpassword,'ju');
                                $unix_newpassword = crypt($newpassword);
                                $crpt = new Crypt_CHAP_MSv1;
                                $crpt->password = $newpassword;
                                $lm_newpassword = bin2hex($crpt->lmPasswordHash());
                                $nt_newpassword = bin2hex($crpt->ntPasswordHash());
                                $query = "UPDATE users SET "
                                                ."crypt_password = '$crypt_newpassword',"
                                                ."nt_password = '$nt_newpassword', "
                                                ."lm_password = '$lm_newpassword', "
                                                ."unix_password = '$unix_newpassword'"
                                                ."WHERE local_part = '$emailid'";
                                $result = mysql_query($query) or die("Error ".mysql_error());
                                echo "Password successfully changed!!!";
                        }
                        else
                        {
                                $errmsg  =  "<font color='#FF0000'>Sorry, Incorrect password!!!</font>";
                        }
                }
                else
                {
                        $errmsg  =  "<font color='#FF0000'>Sorry, Incorrect email_id!!!</font>";
                }

           // $content = htmlspecialchars($content);
        }
}

include 'library/closedb.php';
?>          
          <form id="form1" name="form1" method="post" action="">
            <table width="47%" border="0" align="left" cellpadding="0" cellspacing="0">
              <tr>
                <td colspan="3" width="39%" align="right"><?php echo $errmsg; $errmsg = '';?></td>
                </tr>
              <tr>
                <td align="right">Email ID  : </td>
                <td align="left"><input name="emailid" type="text" id="emailid" value="<?=$emailid;?>" />
                    <br />
                    <font color="#FF0000"> <?php echo $errmsgemailid; 
		  		$errmsgemailid = '';
		  ?> </font> </td>
                <td>&nbsp;</td>
                </tr>
              <tr>
                <td align="right">&nbsp;</td>
                <td align="left">&nbsp;</td>
                <td>&nbsp;</td>
              </tr>
              <tr>
                <td align="right">Old Password  :</td>
                  <td align="left"><input name="oldpassword" type="password" id="oldpassword" value="<?=$oldpassword;?>" />
                    <br />
                  <font color="#FF0000"> <?php echo $errmsgoldpassword; 
		  		$errmsgoldpassword = '';
		  ?> </font> </td>
                  <td>&nbsp;</td>
                </tr>
              <tr>
                <td align="right">&nbsp;</td>
                  <td align="left">&nbsp;</td>
                  <td>&nbsp;</td>
                </tr>
              <tr>
                <td align="right">New Password  :</td>
                  <td align="left"><input name="newpassword" type="password" id="newpassword" value="<?=$newpassword;?>" />
                    <span style="color:green" id='result'></span>
                    <br />
                  <font color="#FF0000"> <?php echo $errmsgnewpassword; 
		  		$errmsgnewpassword = '';
		  ?> </font> </td>
                  <td>&nbsp;</td>
                </tr>
              <tr>
                <td align="right">&nbsp;</td>
                  <td align="left">&nbsp;</td>
                  <td>&nbsp;</td>
                </tr>
              <tr>
                <td align="right">Confirm new password  : </td>
                  <td align="left"><input name="confirmnewpassword" type="password" id="confirmnewpassword" value="<?=$confirmnewpass;?>" />
                    <br />
                  <font color="#FF0000"> <?php echo $errmsgconfirmnewpass; 
		  		$errmsgconfirmnewpass = '';
		  ?> </font> </td>
                  <td>&nbsp;</td>
                </tr>
              <tr>
                <td align="right">&nbsp;</td>
                  <td align="left">&nbsp;</td>
                  <td>&nbsp;</td>
                </tr>
              <tr>
                <td>&nbsp;</td>
                  <td align="left"><input name="submit" type="submit" id="submit" value="Submit" /></td>
                  <td>&nbsp;</td>
                </tr>
              </table>
          </form></td>
        </tr>
      
      <tr>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td width="282" valign="top">&nbsp;</td>
        <td colspan="2" class="bodyText">&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td valign="top">&nbsp;</td>
        <td colspan="2" class="bodyText">&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td valign="top">&nbsp;</td>
        <td colspan="2" class="bodyText">&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td valign="top">&nbsp;</td>
        <td colspan="2" class="bodyText">&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td valign="top">&nbsp;</td>
        <td colspan="2" class="bodyText">&nbsp;</td>

        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td valign="top">&nbsp;</td>
        <td colspan="2" class="bodyText">&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td valign="top">&nbsp;</td>
        <td colspan="2" class="bodyText">&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td valign="top">&nbsp;</td>
        <td colspan="2" class="bodyText">&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
    </table>
    .    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" id="bottom">
 <tr>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td colspan="2" valign="top" bgcolor="#F7F7F7">
		Copyright &copy; 2008, Jimma University <BR> 
		<B>All Rights Reserved</B>	</td>
    <td valign="top" bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
  </tr>
  <tr>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
  </tr>
  <tr>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
  </tr>
  <tr>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
  </tr>
  <tr>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
  </tr>
  <tr>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
  </tr>
  <tr>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
  </tr>
  <tr>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
    <td bgcolor="#F7F7F7">&nbsp;</td>
  </tr>
</table>
</body>
</html>
